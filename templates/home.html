<!DOCTYPE html>
<html lang="en">
<head>
    <title>RESQALERT AI Core</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

    <style>
        * { margin:0; padding:0; box-sizing:border-box; }

        body {
            min-height:100vh;
            background: radial-gradient(circle at top, #0f172a, #020617 70%);
            font-family:'Inter', sans-serif;
            color:#e2e8f0;
            display:flex;
            justify-content:center;
            align-items:center;
            overflow:hidden;
        }

        .panel {
            width:900px;
            max-width:95%;
            padding:50px;
            border-radius:24px;
            background:rgba(15,23,42,0.85);
            backdrop-filter:blur(30px);
            border:1px solid rgba(0,255,255,0.15);
            box-shadow:0 0 60px rgba(0,255,255,0.08),
                       0 40px 100px rgba(0,0,0,0.7);
            text-align:center;
        }

        h1 {
            font-family:'Orbitron', sans-serif;
            font-size:36px;
            margin-bottom:20px;
            text-shadow:0 0 15px rgba(0,255,255,0.7);
        }

        .orb {
            width:160px;
            height:160px;
            border-radius:50%;
            margin:30px auto;
            background: radial-gradient(circle, #00ffff 0%, #0ea5e9 40%, transparent 70%);
            box-shadow:0 0 40px #00ffff,
                       0 0 80px #0ea5e9;
            animation: rotate 18s linear infinite;
            transition:0.3s ease;
        }

        .speaking {
            transform:scale(1.15);
            box-shadow:0 0 80px #00ffff,
                       0 0 160px #0ea5e9;
        }

        @keyframes rotate {
            from { transform:rotate(0deg); }
            to { transform:rotate(360deg); }
        }

        canvas {
            width:100%;
            height:120px;
            margin-top:20px;
        }

        .info-box {
            margin-top:20px;
            font-family:monospace;
            font-size:13px;
            color:#38bdf8;
            background:rgba(0,0,0,0.45);
            padding:20px;
            border-radius:14px;
            text-align:left;
        }

        footer {
            margin-top:40px;
            font-size:12px;
            color:#475569;
        }
    </style>
</head>
<body>

<div class="panel">

    <h1>RESQALERT AI CORE</h1>

    <div class="orb" id="orb"></div>

    <canvas id="wave"></canvas>

    <div class="info-box">
        <strong>Your Information....</strong><br>
        IP Address: {{ ip }}<br>
        User Agent: {{ user_agent }}<br>
        Referrer: {{ referrer }}<br>
        Server Time: {{ time }}<br><br>

        <strong>Network</strong><br>
        Connection: <span id="conn"></span><br>
        Downlink: <span id="down"></span> Mbps<br>
        RTT: <span id="rtt"></span> ms<br>
        Speed Score: <span id="speed"></span><br>
        Device Memory: <span id="memory"></span> GB<br>
        Cores: <span id="cores"></span><br>
        Timezone: <span id="tz"></span>
    </div>

    <footer>
        © 2026 Soltryx Solutions • AI Monitoring Active
    </footer>

</div>

<script>
const orb = document.getElementById("orb");
const canvas = document.getElementById("wave");
const ctx = canvas.getContext("2d");

canvas.width = canvas.offsetWidth;
canvas.height = canvas.offsetHeight;

let audioContext;
let analyser;
let dataArray;

function initAudio() {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioContext.createAnalyser();
    analyser.fftSize = 256;
    dataArray = new Uint8Array(analyser.frequencyBinCount);
    draw();
}

function draw() {
    requestAnimationFrame(draw);

    if (!analyser) return;

    analyser.getByteFrequencyData(dataArray);
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const barWidth = canvas.width / dataArray.length;

    for (let i = 0; i < dataArray.length; i++) {
        const barHeight = dataArray[i] / 2;
        ctx.fillStyle = `rgb(0, ${150 + barHeight}, 255)`;
        ctx.fillRect(i * barWidth, canvas.height - barHeight, barWidth - 1, barHeight);
    }
}

function speak(text) {
    if (!audioContext) initAudio();

    const utterance = new SpeechSynthesisUtterance(text);
    utterance.rate = 0.9;
    utterance.pitch = 0.85;

    orb.classList.add("speaking");
    utterance.onend = () => orb.classList.remove("speaking");

    window.speechSynthesis.speak(utterance);
}

function getGreeting() {
    const hour = new Date().getHours();
    if (hour < 12) return "Good morning";
    if (hour < 18) return "Good afternoon";
    return "Good evening";
}

async function measureSpeed() {
    const start = performance.now();
    try {
        await fetch('/static/speed-test.png?' + Date.now(), { cache: 'no-store' });
        return (1000 / (performance.now() - start)).toFixed(2);
    } catch {
        return "unknown";
    }
}

function sendDeviceInfo() {
    const conn = navigator.connection || {};

    document.getElementById("conn").innerText = conn.effectiveType || "unknown";
    document.getElementById("down").innerText = conn.downlink || "unknown";
    document.getElementById("rtt").innerText = conn.rtt || "unknown";
    document.getElementById("memory").innerText = navigator.deviceMemory || "unknown";
    document.getElementById("cores").innerText = navigator.hardwareConcurrency || "unknown";
    document.getElementById("tz").innerText = Intl.DateTimeFormat().resolvedOptions().timeZone;

    const data = {
        screen: window.screen.width + "x" + window.screen.height,
        platform: navigator.platform,
        language: navigator.language,
        connection: conn.effectiveType || "unknown",
        downlink: conn.downlink || "unknown",
        rtt: conn.rtt || "unknown",
        memory: navigator.deviceMemory || "unknown",
        cores: navigator.hardwareConcurrency || "unknown",
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        speed: document.getElementById("speed").innerText,
        userAgent: navigator.userAgent
    };

    fetch('/device-info', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    }).catch(console.error);
}

window.onload = async () => {
    document.getElementById("speed").innerText = await measureSpeed();
    sendDeviceInfo();

    setTimeout(() => {
        speak(`${getGreeting()}. Welcome to ResQAlert Backend. Monitoring is active.`);
    }, 1500);
};
</script>

</body>
</html>